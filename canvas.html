<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="canvas.css" />
    <title>Document</title>
</head>
<body>
    <div id="container">
        <canvas id="canvas" class="over"></canvas>
        <video id="video" src="modern_times.mp4" class="over"></video>

    </div>
    <div>
        <button onclick="play();">Play</button>
        <button onclick="pause();">Pause</button>
        <button onclick="animate();">Animate</button>
    </div>
    <script>
        //Each of these should have their own draw methdo to call.
        var animateObjects = [];

        /* 
        Draws a "pop up video" bubble.
        */
        function drawBubble(x, y, radius, width){

            // let radius = 20;
            let lineWidth = 2;

            //left Arc
            let context = canvas.getContext("2d");
            context.beginPath();
            context.arc(x,y,radius, 0.5 * Math.PI, 1.5 * Math.PI);
            context.fillStyle = "#fff";
            context.fill();
            context.strokeStyle = "#000";
            context.lineWidth = lineWidth;
            context.stroke();

            //top line
            context.beginPath();
            context.moveTo(x,y - radius);
            context.lineTo(x + width,y - radius);
            context.stroke();

            //bottom line
            context.beginPath();
            context.moveTo(x,y + radius);
            context.lineTo(x + width,y + radius);
            context.stroke();

            //fill background
            context.fillStyle = "#fff";
            context.fillRect(x, y - radius + (lineWidth/2), width, (radius * 2) - lineWidth);

            //right arc
            context.beginPath();
            context.arc(x + width,y,radius, 1.5 * Math.PI, 0.5 * Math.PI);
            context.fillStyle = "#fff";
            context.fill();
            context.strokeStyle = "#000";
            context.lineWidth = lineWidth;
            context.stroke();
        }

        function drawTest(){
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");

            var radius = 20;
            ctx.beginPath();
            ctx.arc(100,60, 30, 2 * Math.PI, false);    
            
            ctx.fillStyle = 'green';
            ctx.fill();
            ctx.lineWidth = 5;
            ctx.strokeStyle = '#003300';
            ctx.stroke();
        }
    
        //Popup object.
        function PopUp(text, x, y, radius, width, time) {
            this.text = text;
            this.x = x;
            this.y = y;
            this.radius = 0;
            this.width = 0;
            this.time = 0;
            this.animate = false; //Whether the popup should be drawn or not.

            this.currentRadius = 0; //initialize to not-visible.
            this.currentWidth = 0; //Initial the initial width.

            //targetValuses are set at initialization. They are not exposed.
            let targetWidth = width;
            let targetRadius = radius;
            let targetTime = time;

            this.draw = function(){
                if(this.animate === true) {
                    if(this.radius < targetRadius) {
                        this.radius += 2;
                    }else if(this.width < targetWidth) {
                        this.width += 6;
                    }
                    this.time -= 1; //Decrement time, described in frames.
                    drawBubble(this.x, this.y, this.radius, this.width);
                }
            }
        }

        function play(){
            document.getElementById("video").play();
        }
        
        function pause(){
            document.getElementById("video").pause();
        }
    
        document.addEventListener('DOMContentLoaded',e=>{           
            animateObjects.push(new PopUp("I am a Moomanbean!", 100, 100, 10, 130, 35));
            animateObjects[0].animate = true;
            animate(); // start the animation right away.
        });

        function animate() {
            animateObjects.forEach(element => {
                element.draw();
            });            
            setTimeout(animate,1000/60);
        }

    </script>
  </body>
</html>